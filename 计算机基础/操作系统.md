### 0x00 操作系统的主要功能
从资源管理的角度来看，操作系统有6大功能：
1. 进程和线程的管理：完成进程的创建、撤销、阻塞、唤醒和进程间通信；
2. 存储管理：内存和外存的分配和管理；
3. 文件管理：完成文件的读写创建以及删除；
4. 设备管理：完成设备（包括输入输出设备和外部存储设备）的请求和释放，以及设备启动；
5. 网络管理：管理计算机网络的配置、连接、通信和安全；
6. 安全管理：用户的身份认证、访问控制、文件加密。
### 0x01 用户态和内核态的区别
根据进程访问资源的特点，可以把进程在操作系统上的运行分为两个级别：**用户态**和**内核态**。  
用户态运行的进程可以直接读取用户程序的数据，但是权限较低，当应用程序要执行某些需要特殊权限的操作时，如读写磁盘、网络通信等，就需要向操作系统发起系统调用请求，进入内核态。  
内核态运行的进程几乎可以访问计算机的任何资源包括系统的内存空间、设备、驱动程序等，不受限制，拥有非常高的权限。当操作系统接收到进程的系统调用请求时，就会从用户态切换到内核态，执行相应的系统调用，并将结果返回给进程，最后再从内核态切换回用户态。

### 0x02 为什么要划分用户态和内核态？
因为有一些危险指令，比如内存分配、IO处理等，如果所有程序都能使用这些指令，会对系统正常运行产生灾难性影响。所以我们要限制这些危险指令只能在内核态运行。只能被操作系统内核态执行的指令也叫做**特权指令**。  
如果计算机系统中只有一个内核态，那么所有程序或进程都必须共享系统资源，例如内存、CPU、硬盘等，这将导致系统资源的竞争和冲突，从而影响系统性能和效率。

### 0x03 用户态切换到内核态的三种方式
1. 系统调用 Trap：主动切换的一种方式，系统调用的机制其核心是操作系统为用户特别开放的一个中断来实现；
2. 中断 Interrupt：CPU接收到中断信号后，会暂停即将执行的下一条指令，转而去执行与中断信号对应的处理程序，如果先前的指令在用户态下，那么这个转换的过程就实现了用户态到内核态的切换；
3. 异常 Exception：当CPU执行用户态程序异常时，会触发由当前运行进程切换到处理此异常的内核相关程序中，也就转到了内核态。

### 0x04 系统调用的过程
我们运行的程序基本都是在用户态，如果我们调用操作系统提供的内核态级别的子功能就需要系统调用了。
系统调用的过程可以简单分为以下几个步骤：  
1. 用户态的程序发起系统调用，因为系统调用中涉及一些特权指令（只能由操作系统内核态执行的指令），用户态程序权限不足，因此会中断执行，也就是 Trap（Trap 是一种中断）。
2. 发生中断后，当前 CPU 执行的程序会中断，跳转到中断处理程序。内核程序开始执行，也就是开始处理系统调用。
3. 内核处理完成后，主动触发 Trap，这样会再次发生中断，切换回用户态工作。


### 0x05 进程和线程的区别
进程（process）是指正在运行的一个程序实例。比如打开Apex，就是创建了一个游戏进程；  
线程（Thread）可以看作轻量级进程，多个线程可以在同一个进程中同时执行，并且共享进程的资源比如内存空间和网络连接等。  
区别：
- 线程是进程划分的更小的运行单位，一个进程在执行过程中可以产生多个线程；
- 每个进程相互独立，但是线程则不一定，同一进程中的线程可能相互影响；
- 线程执行开销比较小，但是不利于资源管理和保护；进程则相反。

### 0x06有了进程为什么还需要线程？
1. 进程切换开销很大，线程切换成本较低；
2. 线程更加轻量级，一个进程可以创建多个线程；
3. 多线程可以并发处理不同的任务，有效利用计算机多核和多处理器特性。而进程只能在一个时间干一件事，如果在执行过程中遇到阻塞问题比如 IO 阻塞就会挂起直到结果返回；
4. 同一进程内的线程共享内存和文件，因此它们之间相互通信无须调用内核。

### 0x07 乐观锁和悲观锁
概念：  
乐观锁和悲观锁是两种常见的并发控制机制，在多进程和多线程访问共享资源时起到关键作用。  
乐观锁是假设大多数情况下不会发生冲突，所以不加锁。在操作数据时，先读取数据并记录版本号或时间戳。提交更新时，检查记录的版本号或时间戳是否变化，如果未变化，则执行更新操作；如果变化了，则认为有冲突，操作失败或重试。  
悲观锁是假设大多数情况下都会发生冲突，因此在操作数据前，先对数据加锁，阻止其他事务对数据的修改，直到当前事务完成。这样可以确保在锁持有期间，其他事务无法修改数据。  
应用场景：  
乐观锁适合读多写少的场景，因为数据冲突概率较低，可用于电商平台商品详情页，因为查看较多，实际操作较少；悲观锁适合写多读少的场景，适合银行系统的转账操作，确保一致性和安全性。

### 0x08 产生死锁的四个必要条件
1. 互斥：资源必须处于非共享模式，即一次只有一个进程可以使用。如果另一进程申请该资源，那么必须等待直到该资源被释放为止；
2. 占有并等待：一个进程至少应该占有一个资源，并等待另一资源，而该资源被其他进程所占有；
3. 非抢占：资源不能被抢占。只能在持有资源的进程完成任务后，该资源才会被释放；
4. 循环等待：有一组等待进程循环等待资源。







